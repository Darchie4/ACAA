# Interactive containers

This folder contains components for creating a custom image that can be used to interact with HDFS by a Python client, to run other commands, and to create files using Visual Studio Code inside Kubernetes.  

The deployment manifest [`interactive.yaml`](./interactive.yaml) includes a pod definition for the interactive container and another resources used to claim persistent storage in Kubernetes.

The following cmd below can be used for creating a temporary instance of the image.
```bash
kubectl run interactive --rm -i --tty --image registry.gitlab.sdu.dk/jah/bigdatarepo/interactive:latest
```

## Attach Visual Studio Code to a running container
One convenient approach for making development inside Kubernetes is to attach Visual Studio Code to a running container. An introduction to this concept can be found here: [Developing inside a Container](https://code.visualstudio.com/docs/devcontainers/containers).   
You will need the following three extensions to make this work. All of them are developed by Microsoft. 

- [Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack)
- [Dev Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)
- [Kubernetes](https://marketplace.visualstudio.com/items?itemName=ms-kubernetes-tools.vscode-kubernetes-tools)



A Kubernetes icon will appear in the activity bar after the installation of the mentioned extensions. The image below illustrates how to attach Visual Studio Code to the container.

![Attach to a container in a Kubernetes cluster](https://code.visualstudio.com/assets/docs/devcontainers/attach-container/k8s-attach.png)
*Image from [Attach to a container in a Kubernetes cluster. (Accessed: 09 September 2023)](https://code.visualstudio.com/assets/docs/devcontainers/attach-container/k8s-attach.png)*

This will open a new vscode window that is connected to the pod.

Run the following command to start install the required packages for python scripts.:
```bash
pip install -r requirements.txt
```

---
### **Produce Messages with Python**

####  Write a Python producer program.

1. **Define properties for the INGESTION topic:**
   - Example:
     - Partitions: 6
     - Replication factor: 2
     - Minimum in-sync replicas: 2
     - Retention time: 7 days
     - Retention size: 500 MB
    Change the values in the `producer.py` file.

2. **Create the INGESTION topic in Redpanda.**

3. **Python producer setup:**
   - Copy files to the container:
     - `client.py`, `data_model.py`, `producer.py`
   - Run the producer:
     ```bash
     python producer.py
     ```

4. **Verify production:**
   - Open Redpanda at `localhost:8080/topics/INGESTION`.

---

### Consume Messages with Python**

#### Write a Python consumer program.

1. **Create a consumer program:**
   - Files:
     - `client.py`, `data_model.py`, `simple-consumer_pes.py`, `simple-consumer_hmi.py`
   - Run the pes consumer:
     ```bash
     python simple-consumer_pes.py
     ```

2. **Start a second consumer:**
   - Run the hmi consumer:
     ```bash
     python simple-consumer_hmi.py
     ```

This will run the consumer for the pes and hmi topics.
which will consume the messages from the topics.
being produced by the producer.

To create plot of the generated data run the following command:
```bash
python alert_plot.py
```
This will run the plotter for the data generated by the producer 
and collected when abnormalities happen in the system and then is parsed by the monitoring module.

Run the following command to calculate events per second:
```bash
python events_per_second.py
```
This will calculate the events per second for the data generated by the producer and collected by the monitoring module.